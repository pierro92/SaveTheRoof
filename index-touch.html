<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAVE THE ROOF — Aquafire® (NL)</title>
<style>
  :root{
    --bg:#f6f7fb;
    --ink:#0f172a;
    --muted:#64748b;
    --panel:#0a1a33;       /* teinte panneau réaliste */
    --panel-grid:#0d264f;  /* lignes de grille PV */
    --panel-busbar:#c7d2fe;/* barres argentées */
    --panel-cell:#0f2a52;  /* cellules PV */
    --panel-gap:#0b1f3d;   /* inter-cellule assombri */
    --panel-gloss:rgba(255,255,255,.07);
    --flame1:#ffdd55;
    --flame2:#ff9b2f;
    --flame3:#ff5a1f;
    --tile1:#e6e6e6;
    --tile2:#cfcfcf;
    --ok:#15803d;
    --bad:#b91c1c;
    --border:#e5e7eb;
    --accent:#111;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;margin:0;background:var(--bg);color:var(--ink);}
  .container{max-width:1100px;margin:0 auto;padding:20px;}
  h1{margin:0 0 6px 0;font-size:28px}
  .muted{color:var(--muted);font-size:14px}
  .row{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .grid{display:grid;gap:6px}
  .board-wrap{position:relative}
  .cell{
    position:relative;aspect-ratio:1/1;border-radius:10px;border:1px solid #274c8e;background:var(--panel);overflow:hidden;
    /* realistischer PV-paneel: cellen, gaps, busbars, micro-textuur */
    background:
      /* verticale busbars (zilverkleurig) */
      linear-gradient(90deg, transparent 0, transparent 22%, var(--panel-busbar) 22.8%, var(--panel-busbar) 23.8%, transparent 23.8%, transparent 50%,
                              var(--panel-busbar) 50.8%, var(--panel-busbar) 51.8%, transparent 51.8%, transparent 78%,
                              var(--panel-busbar) 78.8%, var(--panel-busbar) 79.8%, transparent 79.8%, transparent 100%),
      /* 4x4-celraster */
      linear-gradient(#0000 24%, var(--panel-gap) 25% 26%, #0000 27%) 0 0/100% 25%,
      linear-gradient(90deg, #0000 24%, var(--panel-gap) 25% 26%, #0000 27%) 0 0/25% 100%,
      radial-gradient(80% 90% at 50% 40%, var(--panel-cell), var(--panel) 80%);
    box-shadow: inset 0 0 18px rgba(0,0,0,.35), inset 0 2px 0 rgba(255,255,255,.05);
  }
  /* glasreflectie */
  .pv-gloss{
    position:absolute;inset:0;
    background:
      linear-gradient(135deg, var(--panel-gloss), transparent 40%);
    pointer-events:none;
  }
  /* schroeven en frame */
  .screw{position:absolute;width:6px;height:6px;border-radius:50%;background:#9aa4b2;box-shadow:0 0 0 1px rgba(0,0,0,.25) inset}
  .screw.tl{left:6px;top:6px}
  .screw.tr{right:6px;top:6px}
  .screw.bl{left:6px;bottom:6px}
  .screw.br{right:6px;bottom:6px}

  /* vlammen */
  .flame{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    width:40px;height:40px;pointer-events:none;
  }
  .flame .f3, .flame .f2, .flame .f1{
    position:absolute;left:50%;bottom:0;transform:translateX(-50%);
    border-radius:50% 50% 50% 50%;
    filter:blur(0.3px);
    animation:flame 0.9s infinite ease-in-out alternate;
  }
  .flame .f3{width:40px;height:40px;background:radial-gradient(circle at 50% 60%, var(--flame3), #b53010 70%);opacity:.85;}
  .flame .f2{width:28px;height:28px;background:radial-gradient(circle at 50% 60%, var(--flame2), #e04b13 70%);animation-delay:.1s;opacity:.9;}
  .flame .f1{width:18px;height:18px;background:radial-gradient(circle at 50% 60%, var(--flame1), #ffb020 70%);animation-delay:.2s;opacity:.95;}
  @keyframes flame{
    from{transform:translateX(-50%) translateY(2px) scale(0.95)}
    to{transform:translateX(-50%) translateY(-2px) scale(1.05)}
  }
  .tile{position:absolute;inset:6px;border-radius:8px;background:linear-gradient(135deg,var(--tile1),var(--tile2));border:1px solid #a8a8a8;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:10px;color:#333;letter-spacing:.4px}
  .pill{border:1px solid var(--border);border-radius:12px;padding:8px 10px;background:#fff;min-width:96px}
  .pill .k{font-size:10px;text-transform:uppercase;color:#6b7280;letter-spacing:.4px}
  .pill .v{font-weight:700}
  .btn{border-radius:10px;padding:10px 14px;border:1px solid #d4d4de;background:#fff;cursor:pointer}
  .btn.primary{background:#111;color:#fff;border-color:#111}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .sidebar{width:320px;flex:0 0 320px}
  .legend{display:flex;gap:16px;color:#555;font-size:13px;margin-bottom:8px}
  .dot{display:inline-block;width:12px;height:12px;border-radius:3px;margin-right:6px;vertical-align:-2px}
  .dot.pv{background:#1d4ed8}
  .dot.fl{background:var(--flame3)}
  .dot.tl{background:var(--tile2);border:1px solid #a8a8a8}
  .status{margin-top:12px;border-radius:12px;border:1px solid var(--border);background:#f8fafc;padding:12px;text-align:center;font-weight:600}
  .ok{color:var(--ok)} .bad{color:var(--bad)}
  .tray{display:flex;gap:8px;flex-wrap:wrap}
  .drag{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--tile1),var(--tile2));border:1px solid #a8a8a8;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;cursor:grab}
  .footer{margin-top:10px;font-size:12px;color:#6b7280}
  .flex{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .space{height:8px}
  @media (max-width: 980px){.sidebar{width:100%;flex:1 1 auto}}
  .toast{
    position:fixed;right:16px;bottom:16px;background:#111;color:#fff;padding:10px 12px;border-radius:10px;font-size:13px;opacity:.9
  }
</style>
</head>
<body>
  <div class="container">
    <div class="row" style="justify-content:space-between;align-items:flex-end">
      <div>
        <h1>Save the Roof</h1>
        <div class="muted">Aquafire® — het onzichtbare schild voor PV-daken</div>
      </div>
      <div class="flex">
        <div class="pill"><div class="k">Tijd</div><div class="v" id="time">45s</div></div>
        <div class="pill"><div class="k">Geblust</div><div class="v" id="ext">0</div></div>
        <div class="pill"><div class="k">Vuur</div><div class="v" id="firecells">0%</div></div>
        <button class="btn" id="muteBtn">🔊 Geluid</button>
        <button class="btn primary" id="startBtn">Starten</button>
        <button class="btn" id="resetBtn">Opnieuw</button>
      </div>
    </div>

    <div class="space"></div>

    <div class="row">
      <!-- BOARD -->
      <div class="card" style="flex:1 1 0;">
        <div class="legend">
          <span><span class="dot pv"></span>PV-paneel</span>
          <span><span class="dot fl"></span>Vlam</span>
          <span><span class="dot tl"></span>Aquafire-tegel</span>
        </div>
        <div id="board" class="board-wrap"></div>
        <div id="status" class="status">Sleep Aquafire-tegels naar brandende vakken. Bedek <b>het hele dak</b> binnen 45 seconden om te winnen.</div>
      </div>

      <!-- SIDEBAR -->
      <div class="card sidebar">
        <h3 style="margin:0 0 8px 0;">Spelregels</h3>
        <ol class="muted" style="padding-left:18px">
          <li>Zet een <b>Aquafire-tegel</b> op een brandend vak om het te blussen.</li>
          <li>Onbeschermde vakken vatten vlam en het vuur breidt zich uit.</li>
          <li>Je hebt <b>onbeperkt</b> tegels. Doel: <b>alles bedekken in 45s</b>.</li>
        </ol>
        <div class="space"></div>
        <h3 style="margin:0 0 8px 0;">Tegels</h3>
        <div id="tray" class="tray"></div>
        <div class="footer">Tip: gebruik een muis of trackpad.</div>
        <div class="space"></div>
        <h3 style="margin:0 0 8px 0;">Aquafire® — highlights</h3>
        <ul class="muted" style="padding-left:18px">
          <li>Euroklasse A1 — onbrandbaar</li>
          <li>Brandbarrière onder PV-systemen</li>
          <li>Compatibel met bitumineuze & synthetische membranen</li>
        </ul>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" style="display:none">Muziek aan</div>

<script>
(function(){
  const ROWS = 4, COLS = 8;
  const TOTAL = ROWS*COLS;
  const GAME_DURATION_MS = 45 * 1000; // 45s
  let spawnIntervalMs = 900;
  let spreadChance = 0.42;
  // State
  let grid = [];
  let extinguished = 0;
  let running = false;
  let musicOn = true;
  let endTime = null;
  let timerId = null;
  // DOM
  const boardEl = document.getElementById('board');
  const trayEl = document.getElementById('tray');
  const timeEl = document.getElementById('time');
  const extEl = document.getElementById('ext');
  const fireEl = document.getElementById('firecells');
  const statusEl = document.getElementById('status');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const muteBtn = document.getElementById('muteBtn');
  const toast = document.getElementById('toast');

  
  // --- Touch/Pointer support (mobile & tablets) ---
  let ghost = null;
  let hoverCell = null;
  let activePointerId = null;

  function placeTileOnCell(cell){
    if(!running) return;
    const r = +cell.dataset.r, c = +cell.dataset.c;
    const target = grid[r][c];
    if(!target.isPanel || target.hasTile) return;
    let didExt = false;
    if(target.hasFlame){ target.hasFlame = false; didExt = true; }
    target.hasTile = true;
    if(didExt){ extinguished++; }
    renderBoard(); updateHUD();
    if(allCovered()){ win(); }
  }

  function startPointerDragTile(e){
    // For mouse we keep native HTML5 DnD; only custom-drag for touch/pen
    if(e.pointerType === 'mouse') return;
    if(!running) return;
    activePointerId = e.pointerId;
    // create ghost tile following finger
    ghost = document.createElement('div');
    ghost.style.position = 'fixed';
    ghost.style.left = '0';
    ghost.style.top = '0';
    ghost.style.width = '58px';
    ghost.style.height = '58px';
    ghost.style.borderRadius = '10px';
    ghost.style.background = 'linear-gradient(135deg,var(--tile1),var(--tile2))';
    ghost.style.border = '1px solid #a8a8a8';
    ghost.style.boxShadow = '0 6px 16px rgba(0,0,0,.2)';
    ghost.style.pointerEvents = 'none';
    ghost.style.zIndex = '9999';
    ghost.style.display = 'flex';
    ghost.style.alignItems = 'center';
    ghost.style.justifyContent = 'center';
    ghost.style.fontWeight = '800';
    ghost.style.fontSize = '10px';
    ghost.style.color = '#333';
    ghost.textContent = 'AQUA';
    document.body.appendChild(ghost);
    // capture pointer
    e.currentTarget.setPointerCapture(activePointerId);
    movePointerDragTile(e);
  }

  function movePointerDragTile(e){
    if(!ghost || e.pointerId !== activePointerId) return;
    ghost.style.transform = `translate(${e.clientX-29}px, ${e.clientY-29}px)`;
    const el = document.elementFromPoint(e.clientX, e.clientY);
    if(hoverCell && hoverCell !== el){ hoverCell.style.outline = ''; }
    // find closest .cell
    let target = el;
    while(target && target !== document.body && !target.classList?.contains('cell')){
      target = target.parentElement;
    }
    hoverCell = target && target.classList?.contains('cell') ? target : null;
    if(hoverCell){
      hoverCell.style.outline = '2px solid #111';
    }
  }

  function endPointerDragTile(e){
    if(e.pointerId !== activePointerId) return;
    if(hoverCell){
      hoverCell.style.outline = '';
      placeTileOnCell(hoverCell);
    }
    if(ghost){ ghost.remove(); ghost = null; }
    hoverCell = null;
    activePointerId = null;
  }
// Audio via WebAudio (chiptune + explosie)
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const ctx = new AudioCtx();
  let musicLoopHandle = null;
  function playTone(freq, time, dur, type='square', gain=0.04){
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, time);
    g.gain.setValueAtTime(gain, time);
    g.gain.exponentialRampToValueAtTime(0.0001, time+dur);
    o.connect(g).connect(ctx.destination);
    o.start(time); o.stop(time+dur);
  }
  function playExplosion(){
    const now = ctx.currentTime;
    [0,0.05,0.12].forEach((d,i)=> playTone(220-40*i, now+d, 0.12+0.05*i, 'square', 0.08));
  }
  function startMusic(){
    stopMusic();
    const tempo = 142;
    const beat = 60/tempo;
    const now = ctx.currentTime + 0.02;
    const bass = [196, 147, 165, 175, 196, 147, 165, 175];
    const arp  = [392, 494, 659, 523, 587, 784, 659, 523];
    const melody = [784, 740, 698, 659, 698, 740, 784, 988, 880, 831, 784, 740, 784, 831, 880, 988];
    for(let i=0;i<melody.length;i++){
      const t = now + i*beat*0.5;
      playTone(melody[i], t, beat*0.45, 'square', 0.03);
      playTone(arp[i%arp.length]/2, t+beat*0.25, beat*0.22, 'triangle', 0.018);
      if(i%2===0) playTone(bass[(i/2)%bass.length], t, beat*0.46, 'square', 0.025);
    }
    const loopDur = melody.length*beat*0.5 + 0.01;
    musicLoopHandle = setTimeout(startMusic, loopDur*1000);
  }
  function stopMusic(){
    if(musicLoopHandle){ clearTimeout(musicLoopHandle); musicLoopHandle = null; }
  }
  function toggleMusic(){
    musicOn = !musicOn;
    if(musicOn){ startMusic(); toastMsg('Muziek aan'); muteBtn.textContent='🔊 Geluid'; }
    else { stopMusic(); toastMsg('Muziek uit'); muteBtn.textContent='🔇 Stilte'; }
  }
  function toastMsg(msg){
    toast.textContent = msg;
    toast.style.display='block';
    setTimeout(()=>toast.style.display='none', 1200);
  }

  // Build grid UI
  function makeInitialGrid(){
    grid = [];
    for(let r=0;r<ROWS;r++){
      const row = [];
      for(let c=0;c<COLS;c++){
        row.push({ r,c, isPanel:true, hasFlame:false, hasTile:false });
      }
      grid.push(row);
    }
  }
  function renderBoard(){
    const gridWrap = document.createElement('div');
    gridWrap.className = 'grid';
    gridWrap.style.gridTemplateColumns = `repeat(${COLS}, minmax(0, 1fr))`;

    for(let r=0;r<ROWS;r++){
      for(let c=0;c<COLS;c++){
        const cell = grid[r][c];
        const cellEl = document.createElement('div');
        cellEl.className = 'cell';
        cellEl.dataset.r = r;
        cellEl.dataset.c = c;

        if(cell.hasFlame){
          const fl = document.createElement('div');
          fl.className = 'flame';
          fl.innerHTML = '<div class="f3"></div><div class="f2"></div><div class="f1"></div>';
          cellEl.appendChild(fl);
        }
        if(cell.hasTile){
          const tl = document.createElement('div');
          tl.className = 'tile';
          tl.textContent = 'AQUAFIRE';
          cellEl.appendChild(tl);
        }

        const gloss = document.createElement('div');
        gloss.className = 'pv-gloss';
        cellEl.appendChild(gloss);
        ['tl','tr','bl','br'].forEach(pos=>{
          const s = document.createElement('div'); s.className='screw '+pos; cellEl.appendChild(s);
        });

        cellEl.addEventListener('dragover', (e)=>e.preventDefault());
        cellEl.addEventListener('drop', onDrop);
        gridWrap.appendChild(cellEl);
      }
    }
    boardEl.innerHTML='';
    boardEl.appendChild(gridWrap);
  }
  function renderTray(){
    trayEl.innerHTML='';
    for(let i=0;i<6;i++){
      const d = document.createElement('div');
      d.className = 'drag';
      d.textContent = 'AQUA';
      d.draggable = true;
      d.addEventListener('dragstart', (e)=>{
        e.dataTransfer.setData('type','tile');
      });
      // Pointer events for touch/pen
      d.addEventListener('pointerdown', startPointerDragTile);
      d.addEventListener('pointermove', movePointerDragTile);
      d.addEventListener('pointerup', endPointerDragTile);
      d.addEventListener('pointercancel', endPointerDragTile);
      trayEl.appendChild(d);
    }
  }
  function updateHUD(){
    extEl.textContent = extinguished;
    const burning = grid.flat().filter(c=>c.hasFlame).length;
    const pct = Math.round(burning / TOTAL * 100);
    fireEl.textContent = pct + '%';
  }
  function updateTimer(){
    if(!running) return;
    const ms = Math.max(0, endTime - Date.now());
    timeEl.textContent = Math.ceil(ms/1000) + 's';
    if(ms <= 0){
      if(allCovered()){
        return win();
      }else{
        return lose();
      }
    }
  }
  function allCovered(){
    return grid.flat().every(c=>c.hasTile);
  }

  // Game flow
  let spawnTick = null;
  function reset(){
    running = false;
    clearInterval(spawnTick);
    clearInterval(timerId);
    stopMusic();
    extinguished = 0;
    makeInitialGrid(); renderBoard(); renderTray(); updateHUD();
    statusEl.className = 'status';
    statusEl.textContent = 'Sleep Aquafire-tegels naar brandende vakken. Bedek het hele dak binnen 45 seconden om te winnen.';
    startBtn.disabled = false;
    timeEl.textContent = '45s';
  }
  function start(){
    // ✅ Important: resume AudioContext on first user interaction
    if (ctx.state === 'suspended') {
      ctx.resume().then(() => {
        console.log('AudioContext resumed');
      }).catch(err => console.warn('Audio resume failed:', err));
    }

    reset();
    running = true;
    startBtn.disabled = true;
    endTime = Date.now() + GAME_DURATION_MS;

    if(musicOn) { startMusic(); }
    timerId = setInterval(updateTimer, 200);

    spawnTick = setInterval(()=>{
      if(!running) return;
      if(Math.random() < 0.65){
        const candidates = grid.flat().filter(c=>c.isPanel && !c.hasTile && !c.hasFlame);
        if(candidates.length){
          const pick = candidates[Math.floor(Math.random()*candidates.length)];
          pick.hasFlame = true;
        }
      }
      const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
      const toIgnite = [];
      grid.flat().forEach(cell=>{
        if(cell.hasFlame){
          dirs.forEach(([dr,dc])=>{
            const rr = cell.r + dr, cc = cell.c + dc;
            if(rr>=0 && rr<ROWS && cc>=0 && cc<COLS){
              const n = grid[rr][cc];
              if(n.isPanel && !n.hasTile && !n.hasFlame && Math.random()<spreadChance){
                toIgnite.push(n);
              }
            }
          });
        }
      });
      toIgnite.forEach(n=> n.hasFlame = true);
      renderBoard(); updateHUD();
      if(allCovered()){ win(); }
    }, spawnIntervalMs);
  }

  function win(){
    if(!running) return;
    running = false; clearInterval(spawnTick); clearInterval(timerId); stopMusic();
    statusEl.className = 'status ok';
    statusEl.innerHTML = `🎉 <b>Gefeliciteerd</b>, u heeft uw PV-dak bedekt met <b>AQUAFIRE</b>!<br>`+
      `Neem gerust contact op met <b>Polyglass NL</b><br><b>0343 - 59 50 10</b> — <b>info@polyglass.nl</b>`;
    startBtn.disabled = false;
    playTone(880, ctx.currentTime, 0.2, 'square', 0.05);
    playTone(1175, ctx.currentTime+0.2, 0.2, 'square', 0.05);
    playTone(1568, ctx.currentTime+0.4, 0.3, 'square', 0.05);
  }

  function lose(){
    if(!running) return;
    running = false; clearInterval(spawnTick); clearInterval(timerId); stopMusic(); playExplosion();
    statusEl.className = 'status bad';
    statusEl.innerHTML = `⏱️ Jammer — als u <b>AQUAFIRE</b> had gebruikt, zou uw dak nog intact zijn.<br>`+
      `Neem de volgende keer contact op met <b>Polyglass NL</b><br><b>0343 - 59 50 10</b> — <b>info@polyglass.nl</b>`;
    startBtn.disabled = false;
  }

  function onDrop(e){
    e.preventDefault();
    const type = e.dataTransfer.getData('type');
    if(type !== 'tile') return;
    if(!running) return;
    const r = +this.dataset.r, c = +this.dataset.c;
    const cell = grid[r][c];
    if(!cell.isPanel || cell.hasTile) return;
    let didExt = false;
    if(cell.hasFlame){ cell.hasFlame = false; didExt = true; }
    cell.hasTile = true;
    if(didExt){ extinguished++; }
    renderBoard(); updateHUD();
    if(allCovered()){ win(); }
  }

  // Wire buttons
  startBtn.addEventListener('click', start);
  resetBtn.addEventListener('click', reset);
  muteBtn.addEventListener('click', ()=>{
    toggleMusic();
    if(musicOn) ctx.resume();
  });

  // Init
  reset();
})();
</script>
</body>
</html>
